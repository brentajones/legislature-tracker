/**
 * Views for the Legislator Tracker app
 */(function(e,t,n){LT.MainApplicationView=Backbone.View.extend({initialize:function(e){this.$el.addClass("ls");this.templates=this.templates||{};LT.utils.getTemplate("template-loading",this.templates,"loading");LT.utils.getTemplate("template-error",this.templates,"error");LT.utils.getTemplate("template-ebill",this.templates,"ebill");LT.utils.getTemplate("template-osbill",this.templates,"osbill");LT.utils.getTemplate("template-category",this.templates,"category");LT.utils.getTemplate("template-categories",this.templates,"categories");LT.utils.getTemplate("template-header",this.templates,"header");_.bindAll(this)},events:{"click .bill-expand":"expandBill","click .expand-other-bills":"expandOtherBills"},loading:function(){_.isNumber(LT.options.scrollOffset)&&(this.initialLoad===!0?this.resetScrollView():this.initialLoad=_.isUndefined(this.initialLoad)?!1:!0);this.$el.html(this.templates.loading({}));return this},error:function(e){this.$el.html(this.templates.error({error:e}));return this},renderCategories:function(){this.$el.html(this.templates.categories({categories:LT.app.categories.toJSON(),options:LT.options}))},renderCategory:function(e){var t=this,n;_.isObject(e)||(e=LT.app.categories.get(e));e.get("bills").sort();this.$el.html(this.templates.category({category:e.toJSON(),templates:this.templates,header:this.renderHeader()}));this.getLegislators().navigationGlue()},renderEBill:function(e){_.isObject(e)||(e=this.router.bills.get(e));e.newestAction();this.$el.html(this.templates.ebill({bill:e.toJSON(),expandable:!1,templates:this.templates,header:this.renderHeader()}));this.getLegislators().addTooltips().checkOverflows().navigationGlue()},renderOSBill:function(e){this.$el.html(this.templates.osbill({bill:e.toJSON(),detailed:!0,templates:this.templates,header:this.renderHeader()}));this.getLegislators().addTooltips().checkOverflows().navigationGlue()},renderHeader:function(){return this.templates.header({categories:LT.app.categories.toJSON()})},expandBill:function(t){t.preventDefault();var n=e(t.target),r=["More detail","Less detail"],i=n.text();n.text(i===r[0]?r[1]:r[0]);n.parent().parent().toggleClass("expanded").find(".bill-bottom").slideToggle();this.checkOverflows();return this},expandOtherBills:function(t){t.preventDefault();var n=e(t.target),r=["Show other bills","Hide other bills"],i=n.text();n.text(i===r[0]?r[1]:r[0]);n.parent().find(".has-conference-bill").toggleClass("showing").slideToggle();this.checkOverflows();return this},getLegislators:function(){this.$el.find(".sponsor:not(.found)").each(function(){var t=e(this),n=t.data();n.id=n.legId;if(n.id){var r=LT.utils.getModel("OSLegislatorModel","id",n);e.when(LT.utils.fetchModel(r)).then(function(){var e=(new LT.LegislatorView({el:t,model:r})).render()})}});return this},addTooltips:function(){this.$el.find(".bill-progress .bill-progress-section.completed").qtip({style:{classes:"qtip-shadow qtip-light"},position:{my:"bottom center",at:"top center"}});return this},checkOverflows:function(){this.$el.find(".actions-inner, .co-sponsors-inner").each(function(){e(this).hasScrollBar()&&e(this).addClass("overflowed")});return this},resetScrollView:function(){e("html, body").animate({scrollTop:this.$el.offset().top-LT.options.scrollOffset},1e3);return this},navigationGlue:function(){var n=this.$el.offset().top,r=e(".ls-header");e(".ls-header-container").height(r.outerHeight());e(t).scroll(function(){var t=e(this);t.scrollTop()>n&&!r.hasClass("glued")?r.addClass("glued"):t.scrollTop()<=n&&r.hasClass("glued")&&r.removeClass("glued")});return this}});LT.LegislatorView=Backbone.View.extend({model:LT.OSLegislatorModel,initialize:function(e){this.templates=this.templates||{};LT.utils.getTemplate("template-legislator",this.templates,"legislator");_.bindAll(this)},render:function(){this.$el.addClass("found").html(this.templates.legislator(this.model.toJSON()));return this}})})(jQuery,window);